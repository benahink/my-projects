/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2017 Jakub Beneš <benes@webscope.io>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react-dom"),require("react")):"function"==typeof define&&define.amd?define(["react-dom","react"],t):e.ReactTextareaAutocomplete=t(e.ReactDOM,e.React)}(this,function(c,I){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o="function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?function(e){return t(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)})(e)}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}c=c&&c.hasOwnProperty("default")?c.default:c,I=I&&I.hasOwnProperty("default")?I.default:I;var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var p,S=(function(e){var u,p,f;u=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],p="undefined"!=typeof window,f=p&&null!=window.mozInnerScreenX,e.exports=function(e,t,n){if(!p)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=n&&n.debug||!1;if(r){var o=document.querySelector("#input-textarea-caret-position-mirror-div");o&&o.parentNode.removeChild(o)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var i=a.style,s=window.getComputedStyle?getComputedStyle(e):e.currentStyle;i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.wordWrap="break-word"),i.position="absolute",r||(i.visibility="hidden"),u.forEach(function(e){i[e]=s[e]}),f?e.scrollHeight>parseInt(s.height)&&(i.overflowY="scroll"):i.overflow="hidden",a.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var l=document.createElement("span");l.textContent=e.value.substring(t)||".",a.appendChild(l);var c={top:l.offsetTop+parseInt(s.borderTopWidth),left:l.offsetLeft+parseInt(s.borderLeftWidth)};return r?l.style.backgroundColor="#aaa":document.body.removeChild(a),c}}(p={exports:{}},p.exports),p.exports),f=e.CustomEvent;var k=function(){try{var e=new f("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?f:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,n.detail=t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),t.detail):(n.bubbles=!1,void(n.cancelable=!1)),n},d={ESC:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,TAB:9},h=new function e(){var a=this;i(this,e),this.startListen=function(e){e&&e.addEventListener("keydown",a.f)},this.stopListen=function(e){e&&e.removeEventListener("keydown",a.f)},this.add=function(e,t){var n=e;return"object"!=typeof n&&(n=[n]),a.listeners[a.index]={keyCode:n,fn:t},a.index++},this.remove=function(e){delete a.listeners[e]},this.removeAll=function(){a.listeners={},a.index=1},this.index=1,this.listeners={},this.f=function(r){if(r){var o=r.keyCode||r.which;Object.values(a.listeners).forEach(function(e){var t=e.keyCode,n=e.fn;t.includes(o)&&(r.stopPropagation(),r.preventDefault(),n(r))})}}},g=function(e){function a(){var e,n;i(this,a);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(n=s(this,(e=l(a)).call.apply(e,[this].concat(r)))).selectItem=function(){var e=n.props,t=e.item;(0,e.onSelectHandler)(t)},n}return u(a,I.Component),n(a,[{key:"shouldComponentUpdate",value:function(e){return this.props.item!==e.item||this.props.selected!==e.selected||this.props.style!==e.style||this.props.className!==e.className}},{key:"render",value:function(){var t=this,e=this.props,n=e.component,r=e.style,o=e.onClickHandler,a=e.item,i=e.selected,s=e.className,l=e.innerRef;return I.createElement("li",{className:"rta__item  ".concat(!0===i?"rta__item--selected":""," ").concat(s||""),style:r},I.createElement("div",{className:"rta__entity ".concat(!0===i?"rta__entity--selected":""),role:"button",tabIndex:0,onClick:o,onFocus:this.selectItem,onMouseEnter:this.selectItem,onTouchStart:function(){t.clicked=!0,t.selectItem()},onTouchEnd:function(e){e.preventDefault(),t.clicked&&o(e)},onTouchMove:function(){t.clicked=!1},onTouchCancel:function(){t.clicked=!1},ref:l},I.createElement(n,{selected:i,entity:a})))}}]),a}(),O=function(e){function o(){var e,a;i(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(a=s(this,(e=l(o)).call.apply(e,[this].concat(n)))).state={selectedItem:null},a.cachedIdOfItems=new Map,a.onPressEnter=function(e){void 0!==e&&e.preventDefault();var t=a.props.values;a.modifyText(t[a.getPositionInList()])},a.getPositionInList=function(){var e=a.props.values,t=a.state.selectedItem;return t?e.findIndex(function(e){return a.getId(e)===a.getId(t)}):0},a.getId=function(e){if(a.cachedIdOfItems.has(e))return a.cachedIdOfItems.get(e);var t=a.props.getTextToReplace(e),n=function(){if(t){if(t.key)return t.key;if("string"==typeof e||!e.key)return t.text}if(!e.key)throw new Error("Item ".concat(JSON.stringify(e),' has to have defined "key" property'));return e.key}();return a.cachedIdOfItems.set(e,n),n},a.listeners=[],a.itemsRef={},a.modifyText=function(e){e&&(0,a.props.onSelect)(e)},a.selectItem=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];a.state.selectedItem!==e&&a.setState({selectedItem:e},function(){t&&a.props.dropdownScroll(a.itemsRef[a.getId(e)])})},a.scroll=function(e){e.preventDefault();var t,n=a.props.values,r=e.keyCode||e.which,o=a.getPositionInList();switch(r){case d.DOWN:t=o+1;break;case d.UP:t=o-1;break;default:t=o}t=(t%n.length+n.length)%n.length,a.selectItem(n[t],[d.DOWN,d.UP].includes(r))},a.isSelected=function(e){var t=a.state.selectedItem;return!!t&&a.getId(t)===a.getId(e)},a}return u(o,I.Component),n(o,[{key:"componentDidMount",value:function(){this.listeners.push(h.add([d.DOWN,d.UP],this.scroll),h.add([d.ENTER,d.TAB],this.onPressEnter));var e=this.props.values;e&&e[0]&&this.selectItem(e[0])}},{key:"componentDidUpdate",value:function(e){var t=this,n=e.values,r=this.props.values;n.map(function(e){return t.getId(e)}).join("")!==r.map(function(e){return t.getId(e)}).join("")&&r&&r[0]&&this.selectItem(r[0])}},{key:"componentWillUnmount",value:function(){for(var e;this.listeners.length;)e=this.listeners.pop(),h.remove(e)}},{key:"render",value:function(){var n=this,e=this.props,t=e.values,r=e.component,o=e.style,a=e.itemClassName,i=e.className,s=e.itemStyle;return I.createElement("ul",{className:"rta__list ".concat(i||""),style:o},t.map(function(t){return I.createElement(g,{key:n.getId(t),innerRef:function(e){n.itemsRef[n.getId(t)]=e},selected:n.isSelected(t),item:t,className:a,style:s,onClickHandler:n.onPressEnter,onSelectHandler:n.selectItem,component:r})}))}}]),o}();var m="next",v={LEFT:"rta__autocomplete--left",RIGHT:"rta__autocomplete--right"},y={TOP:"rta__autocomplete--top",BOTTOM:"rta__autocomplete--bottom"},P=function(e){return console.error("RTA: dataProvider fails: ".concat(e,"\n    \nCheck the documentation or create issue if you think it's bug. https://github.com/webscopeio/react-textarea-autocomplete/issues"))},L=function(e){function t(){return i(this,t),s(this,l(t).apply(this,arguments))}return u(t,I.Component),n(t,[{key:"componentDidMount",value:function(){var e=this.props.boundariesElement;if("string"==typeof e){var t=document.querySelector(e);if(!t)throw new Error("RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.");this.containerElem=t}else{if(!(e instanceof HTMLElement))throw new Error("RTA: Invalid prop boundariesElement: it has to be string or HTMLElement.");this.containerElem=e}if(!(this.containerElem&&this.containerElem.contains(this.ref)||"test"===process.env.NODE_ENV))throw new Error("RTA: Invalid prop boundariesElement: it has to be one of the parents of the RTA.")}},{key:"componentDidUpdate",value:function(){var e,t,n=this.props.top||0,r=this.props.left||0,o=[],a=[],i=0,s=0,l=this.containerElem.getBoundingClientRect(),c=this.ref.getBoundingClientRect(),u=this.props.textareaRef.getBoundingClientRect(),p=window.getComputedStyle(this.ref),f=parseInt(p.getPropertyValue("margin-top"),10),d=parseInt(p.getPropertyValue("margin-bottom"),10),h=parseInt(p.getPropertyValue("margin-left"),10),g=parseInt(p.getPropertyValue("margin-right"),10),m=f+d+u.top+n+c.height;h+g+u.left+r+c.width>l.right?(s=r-c.width,o.push(v.LEFT),a.push(v.RIGHT)):(s=r,o.push(v.RIGHT),a.push(v.LEFT)),m>l.bottom?(i=n-c.height,o.push(y.TOP),a.push(y.BOTTOM)):(i=n,o.push(y.BOTTOM),a.push(y.TOP)),this.props.renderToBody&&(i+=u.top,s+=u.left),this.ref.style.top="".concat(i,"px"),this.ref.style.left="".concat(s,"px"),(e=this.ref.classList).remove.apply(e,a),(t=this.ref.classList).add.apply(t,o)}},{key:"render",value:function(){var t=this,e=this.props,n=e.style,r=e.className,o=e.innerRef,a=e.children,i=e.renderToBody,s=document.body,l=I.createElement("div",{ref:function(e){t.ref=e,o(e)},className:"rta__autocomplete ".concat(r||""),style:n},a);return i&&null!==s?c.createPortal(l,s):l}}]),t}(),b=function(e){function a(e){var _;i(this,a),(_=s(this,l(a).call(this,e))).state={top:null,left:null,currentTrigger:null,actualToken:"",data:null,value:"",dataLoading:!1,selectionEnd:0,component:null,textToReplace:null},_.escListenerInit=function(){_.escListener||(_.escListener=h.add(d.ESC,_._closeAutocomplete))},_.escListenerDestroy=function(){_.escListener&&(h.remove(_.escListener),_.escListener=null)},_.getSelectionPosition=function(){return _.textareaRef?{selectionStart:_.textareaRef.selectionStart,selectionEnd:_.textareaRef.selectionEnd}:null},_.getSelectedText=function(){if(!_.textareaRef)return null;var e=_.textareaRef,t=e.selectionStart,n=e.selectionEnd;return t===n?null:_.state.value.substr(t,n-t)},_.setCaretPosition=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;_.textareaRef&&(_.textareaRef.focus(),_.textareaRef.setSelectionRange(e,e))},_.getCaretPosition=function(){return _.textareaRef?_.textareaRef.selectionEnd:0},_._handleCaretChange=function(e){var t=function(){var e=_.getCaretPosition()-1;_.lastTrigger=_.lastTrigger?e:0};if("keydown"!==e.type)t();else switch(e.keyCode||e.which){case d.UP:case d.DOWN:_._isAutocompleteOpen()||t();break;case d.LEFT:case d.RIGHT:t()}},_._onSelect=function(e){var t=_.state,n=t.selectionEnd,r=t.currentTrigger,o=t.value,a=_.props,i=a.trigger,s=a.onItemSelected;if(r){var l=_._getTextToReplace(r);if(l){var c=l(e);if(c){s&&s({currentTrigger:r,item:e});var u=o.slice(0,n),p=u.search(new RegExp("\\".concat(r,"[^\\".concat(r).concat(i[r].allowWhitespace?"":"\\s","]"),"*$"))),f="next"===c.caretPosition?"".concat(c.text," "):c.text,d=function(e,t,n){switch(e){case"start":return n;case"next":case"end":return n+t.length;default:if(!Number.isInteger(e))throw new Error('RTA: caretPosition should be "start", "next", "end" or number.');return e}}(c.caretPosition,f,p),h=u.substring(0,p)+f,g=o.replace(u,h);_.setState({value:g,dataLoading:!1},function(){var e=_.tokenRegExpEnding.exec(f),t=e?e[0].length:1;_.lastTrigger=d?d-t:d,_.textareaRef.value=g,_.textareaRef.selectionEnd=d,_._changeHandler();var n=_.textareaRef.scrollTop;_.setCaretPosition(d),window.chrome&&(_.textareaRef.scrollTop=n)})}else _._closeAutocomplete()}else _._closeAutocomplete()}},_._getTextToReplace=function(n){var e=_.props.trigger[n];if(!n||!e)return null;var r=e.output;return function(e){if("object"==typeof e&&(!r||"function"!=typeof r))throw new Error('Output functor is not defined! If you are using items as object you have to define "output" function. https://github.com/webscopeio/react-textarea-autocomplete#trigger-type');if(r){var t=r(e,n);if(void 0===t||"number"==typeof t)throw new Error('Output functor should return string or object in shape {text: string, caretPosition: string | number}.\nGot "'.concat(String(t),'". Check the implementation for trigger "').concat(n,'"\n\nSee https://github.com/webscopeio/react-textarea-autocomplete#trigger-type for more information.\n'));if(null===t)return null;if("string"==typeof t)return{text:t,caretPosition:m};if(!t.text)throw new Error('Output "text" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger "'.concat(n,'"\n'));if(!t.caretPosition)throw new Error('Output "caretPosition" is not defined! Object should has shape {text: string, caretPosition: string | number}. Check the implementation for trigger "'.concat(n,'"\n'));return t}if("string"!=typeof e)throw new Error("Output item should be string\n");return{text:"".concat(n).concat(e).concat(n),caretPosition:m}}},_._getCurrentTriggerSettings=function(){var e=_.state.currentTrigger;return e?_.props.trigger[e]:null},_._getValuesFromProvider=function(){var e=_.state,t=e.currentTrigger,n=e.actualToken,r=_._getCurrentTriggerSettings();if(t&&r){var o=r.dataProvider,a=r.component;if("function"!=typeof o)throw new Error("Trigger provider has to be a function!");_.setState({dataLoading:!0});var i=o(n);i instanceof Promise||(i=Promise.resolve(i)),i.then(function(e){if(!Array.isArray(e))throw new Error("Trigger provider has to provide an array!");if("function"!=typeof a)throw new Error("Component should be defined!");t===_.state.currentTrigger&&(e.length?_.setState({dataLoading:!1,data:e,component:a}):_._closeAutocomplete())}).catch(function(e){return P(e.message)})}},_._getSuggestions=function(){var e=_.state,t=e.currentTrigger,n=e.data;return!t||!n||n&&!n.length?null:n},_._createRegExp=function(){var e=_.props.trigger;_.tokenRegExp=new RegExp("(".concat(Object.keys(e).sort(function(e,t){return e<t?1:t<e?-1:0}).map(function(e){return"\\".concat(e)}).join("|"),")((?:(?!\\1)[^\\s])*$)")),_.tokenRegExpEnding=new RegExp("(".concat(Object.keys(e).sort(function(e,t){return e<t?1:t<e?-1:0}).map(function(e){return"\\".concat(e)}).join("|"),")$"))},_._closeAutocomplete=function(){_.escListenerDestroy(),_.setState({data:null,dataLoading:!1,currentTrigger:null})},_._cleanUpProps=function(){var e=function(o){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.forEach(function(e){var t,n,r;t=o,r=a[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return o}({},_.props),t=["loadingComponent","boundariesElement","containerStyle","minChar","scrollToItem","ref","innerRef","onChange","onCaretPositionChange","className","value","trigger","listStyle","itemStyle","containerStyle","loaderStyle","className","containerClassName","listClassName","itemClassName","loaderClassName","dropdownStyle","dropdownClassName","movePopupAsYouType","textAreaComponent","renderToBody","onItemSelected"];for(var n in e)t.includes(n)&&delete e[n];return e},_._changeHandler=function(e){var t=_.props,n=t.trigger,r=t.onChange,o=t.minChar,a=t.onCaretPositionChange,i=t.movePopupAsYouType,s=_.state,l=s.top,c=s.left,u=e;u||(u=new k("change",{bubbles:!0}),_.textareaRef.dispatchEvent(u));var p=u.target,f=p.selectionEnd,d=p.value;(_.lastValueBubbledEvent=d,r&&u&&(u.persist&&u.persist(),r(u)),a)&&a(_.getCaretPosition());_.setState({value:d});var h=function(){var e=S(p,f),t=e.top,n=e.left;_.setState({top:t-_.textareaRef.scrollTop||0,left:n})},g=function(e){_.lastTrigger=f-e,_._closeAutocomplete(),h()};if(f<=_.lastTrigger){var m=d.slice(0,f),v=_.tokenRegExp.exec(m);g(v?v[0].length:0)}var y=d.slice(_.lastTrigger,f),b=_.tokenRegExp.exec(y),T=b&&b[0],w=b&&b[1]||null,x=w?w.length-1:0,E=_.tokenRegExpEnding.exec(y);if(E?g(E[0].length):_._isAutocompleteOpen()||_._closeAutocomplete(),T&&!(T.length<=o+x)||(!_.state.currentTrigger||n[_.state.currentTrigger].allowWhitespace)&&_.state.currentTrigger)if(w&&n[w].afterWhitespace&&!/\s/.test(d[f-T.length-1])&&void 0!==d[f-T.length-1])_._closeAutocomplete();else{if(_.state.currentTrigger&&n[_.state.currentTrigger].allowWhitespace){if(b=new RegExp("\\".concat(_.state.currentTrigger,".*$")).exec(d.slice(0,f)),!(T=b&&b[0]))return void _._closeAutocomplete();w=Object.keys(n).find(function(e){return e===T[0]})||null}var C=T.slice(1);if(w){(i||null===l&&null===c||_.state.currentTrigger!==w)&&h(),_.escListenerInit();var R=_._getTextToReplace(w);_.setState({selectionEnd:f,currentTrigger:w,textToReplace:R,actualToken:C},function(){try{_._getValuesFromProvider()}catch(e){P(e.message)}})}}else _._closeAutocomplete()},_._selectHandler=function(e){var t=_.props,n=t.onCaretPositionChange,r=t.onSelect;n&&n(_.getCaretPosition());r&&(e.persist(),r(e))},_._onClickAndBlurHandler=function(e){var t=_.props.onBlur,n=e.relatedTarget;null===n&&(n=document.activeElement),_.dropdownRef&&n instanceof Node&&_.dropdownRef.contains(n)||(_._closeAutocomplete(),t&&(e.persist(),t(e)))},_._onScrollHandler=function(){_._closeAutocomplete()},_._dropdownScroll=function(e){var t=_.props.scrollToItem;if(t){if(!0===t)return n=_.dropdownRef,r=e,o=parseInt(getComputedStyle(r).getPropertyValue("height"),10),a=parseInt(getComputedStyle(n).getPropertyValue("height"),10)-o,i=r.offsetTop,s=n.scrollTop,void(i<s+a&&s<i||(n.scrollTop=i));var n,r,o,a,i,s;if("function"!=typeof t||2!==t.length)throw new Error("`scrollToItem` has to be boolean (true for default implementation) or function with two parameters: container, item.");t(_.dropdownRef,e)}},_._isAutocompleteOpen=function(){var e=_.state,t=e.dataLoading,n=e.currentTrigger,r=_._getSuggestions();return!(!t&&!r||!n)},_._textareaRef=function(e){_.props.innerRef&&_.props.innerRef(e),_.textareaRef=e},_.lastTrigger=0,_.escListener=null;var t=_.props,n=t.loadingComponent,r=t.trigger,o=t.value;if(o&&(_.state.value=o),_._createRegExp(),!n)throw new Error("RTA: loadingComponent is not defined");if(!r)throw new Error("RTA: trigger is not defined");return _}return u(a,I.Component),n(a,[{key:"componentDidMount",value:function(){h.startListen(this.textareaRef),this.textareaRef&&this.textareaRef.addEventListener("focus",this._handleCaretChange),this.textareaRef&&this.textareaRef.addEventListener("click",this._handleCaretChange),this.textareaRef&&this.textareaRef.addEventListener("keydown",this._handleCaretChange)}},{key:"componentDidUpdate",value:function(e){var t=e.trigger,n=e.value,r=this.props,o=r.trigger,a=r.value;Object.keys(o).join("")!==Object.keys(t).join("")&&this._createRegExp(),n!==a&&this.lastValueBubbledEvent!==a&&(this.lastTrigger=0,this._changeHandler())}},{key:"componentWillUnmount",value:function(){this.escListenerDestroy(),h.stopListen(this.textareaRef),this.textareaRef&&this.textareaRef.removeEventListener("focus",this._handleCaretChange),this.textareaRef&&this.textareaRef.removeEventListener("click",this._handleCaretChange),this.textareaRef&&this.textareaRef.removeEventListener("keydown",this._handleCaretChange)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.loadingComponent,o=n.style,a=n.className,i=n.listStyle,s=n.itemStyle,l=n.boundariesElement,c=n.movePopupAsYouType,u=n.listClassName,p=n.itemClassName,f=n.dropdownClassName,d=n.dropdownStyle,h=n.containerStyle,g=n.containerClassName,m=n.loaderStyle,v=n.loaderClassName,y=n.textAreaComponent,b=n.renderToBody,T=this.state,w=T.left,x=T.top,E=T.dataLoading,C=T.component,R=T.value,_=T.textToReplace,S=this._isAutocompleteOpen(),k=this._getSuggestions(),P={};return y.component?(e=y.component,P[y.ref]=this._textareaRef):(e=y,P.ref=this._textareaRef),I.createElement("div",{className:"rta ".concat(!0===E?"rta--loading":""," ").concat(g||""),style:h},I.createElement(e,Object.assign({},this._cleanUpProps(),{className:"rta__textarea ".concat(a||""),onChange:this._changeHandler,onSelect:this._selectHandler,onScroll:this._onScrollHandler,onClick:this._onClickAndBlurHandler,onBlur:this._onClickAndBlurHandler,value:R,style:o},P)),S&&I.createElement(L,{innerRef:function(e){t.dropdownRef=e},top:x,left:w,style:d,className:f,movePopupAsYouType:c,boundariesElement:l,textareaRef:this.textareaRef,renderToBody:b},k&&C&&_&&I.createElement(O,{values:k,component:C,style:i,className:u,itemClassName:p,itemStyle:s,getTextToReplace:_,onSelect:this._onSelect,dropdownScroll:this._dropdownScroll}),E&&I.createElement("div",{className:"rta__loader ".concat(null!==k?"rta__loader--suggestion-data":"rta__loader--empty-suggestion-data"," ").concat(v||""),style:m},I.createElement(r,{data:k}))))}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.value;return null==t?null:{value:t}}}]),a}();return b.defaultProps={movePopupAsYouType:!1,value:null,minChar:1,boundariesElement:"body",scrollToItem:!0,textAreaComponent:"textarea",renderToBody:!1},b});
